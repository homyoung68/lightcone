<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì—°êµ¬ì‹¤ í™ˆí˜ì´ì§€</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#111827; --muted:#6b7280; --card:#ffffff; --border:#e5e7eb; --brand:#2563eb; --ring:#93c5fd;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b1020; --fg:#e5e7eb; --muted:#9aa0a6; --card:#0f162e; --border:#1f2937; --brand:#60a5fa; --ring:#2563eb; }
    }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--fg) }
    a{ color:inherit; text-decoration:none }
    header{ position:sticky; top:0; background:rgba(255,255,255,.9); backdrop-filter:blur(8px); border-bottom:1px solid var(--border) }
    @media (prefers-color-scheme: dark){ header{ background:rgba(15,22,46,.85) } }
    .nav{ max-width:960px; margin:0 auto; display:flex; gap:12px; align-items:center; justify-content:space-between; padding:10px 16px }
    .title{ display:flex; gap:10px; align-items:center; font-weight:800; letter-spacing:-.2px }
    .logo{ width:28px; height:28px; border-radius:8px; background:linear-gradient(135deg, var(--brand), #7c3aed) }
    .links{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .btn{ border:1px solid var(--border); background:var(--card); color:var(--fg); border-radius:10px; padding:8px 10px; cursor:pointer }
    main{ max-width:960px; margin:0 auto; padding:24px 16px }
    section{ scroll-margin-top:72px; margin-top:24px }
    h2{ margin:0 0 10px; font-size:22px }
    .sub{ color:var(--muted); margin:4px 0 16px }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px }
    .grid{ display:grid; gap:14px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)) }
    .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
    .pill{ display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; color:var(--muted) }
    .editable{ outline:none; border-radius:8px }
    .editable:focus{ box-shadow:0 0 0 3px var(--ring) }
    .avatar{ width:140px; height:140px; border-radius:12px; border:1px solid var(--border); object-fit:cover; background:#ddd }
    .muted{ color:var(--muted) }
    .a-btn{ display:inline-block; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:var(--card) }
    .mini{ font-size:12px; color:var(--muted) }
    footer{ border-top:1px solid var(--border); margin-top:24px; color:var(--muted) }
    .foot{ max-width:960px; margin:0 auto; padding:16px }
    .badge{ position:fixed; right:12px; bottom:12px; background:#10b981; color:#fff; padding:6px 10px; border-radius:8px; font-size:12px; z-index:9999; box-shadow:0 2px 6px rgba(0,0,0,.2)}
    .admin-only{ display:none } /* VIEW/EDIT ëª¨ë“œì—ì„œ ìˆ¨ê¹€. ADMINì—ì„œë§Œ ë³´ì„ */
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <a id="labName" class="editable" contenteditable="true">â–¡â–¡â–¡ ì—°êµ¬ì‹¤</a>
      </div>
      <div class="links">
        <a href="#people">êµìˆ˜ ì†Œê°œ</a>
        <a href="#publications">ì—°êµ¬</a>
        <a href="#teaching">ìˆ˜ì—…ìë£Œ</a>
        <button id="toggleTheme" class="btn">ğŸŒ— í…Œë§ˆ</button>
        <button id="resetAll" class="btn admin-only">â™»ï¸ ì´ˆê¸°í™”</button>
      </div>
    </nav>
  </header>

  <main>
    <section id="home">
      <h1 id="heroTitle" class="editable" contenteditable="true">â–¡â–¡â–¡ ì—°êµ¬ì‹¤ (Lab for â–¡â–¡â–¡)</h1>
      <p id="heroDesc" class="sub editable" contenteditable="true">
        ë³¸ ì—°êµ¬ì‹¤ì€ ìƒëŒ€ë¡ ì  ì¿¼í¬ ëª¨í˜•ì„ í™œìš©í•œ ê°•ì…ì ë¬¼ë¦¬ í˜„ìƒë¡  ì—°êµ¬ì™€ ë¬¼ë¦¬ êµìœ¡ì˜ í˜„ì¥ ì ìš©ì— ê´€í•œ ì—°êµ¬ë¥¼ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.
      </p>
      <p class="mini">* ê³µê°œ í˜ì´ì§€ì—ì„œ <code>?edit=1</code>ë¡œ ì ‘ì†í•˜ë©´ ì´ í…ìŠ¤íŠ¸ë§Œ ì„ì‹œ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤(ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥).</p>
    </section>

    <section id="people">
      <h2>êµìˆ˜ ì†Œê°œ</h2>
      <div class="card" style="display:grid; grid-template-columns:140px 1fr; gap:16px">
        <div style="display:grid; gap:10px; justify-items:center">
          <img id="profPhoto" class="avatar" alt="êµìˆ˜ ì‚¬ì§„" src="">
          <input id="photoFile" type="file" accept="image/*" hidden>
          <button id="changePhoto" class="btn admin-only">ì‚¬ì§„ ë³€ê²½</button>
          <button id="removePhoto" class="btn admin-only">ì‚¬ì§„ ì œê±°</button>
          <div class="mini">ê¶Œì¥: ì •ì‚¬ê°í˜• JPG/PNG</div>
        </div>
        <div>
          <div class="row">
            <strong id="profName" class="editable" contenteditable="true">í™ê¸¸ë™</strong>
            <span class="pill">êµìˆ˜</span>
          </div>
          <div id="profAffil" class="editable muted" contenteditable="true" style="margin-top:4px;">â–¡â–¡ëŒ€í•™êµ ë¬¼ë¦¬í•™ê³¼</div>
          <div style="margin-top:10px; display:grid; gap:6px; font-size:14px">
            <div><strong>B.S.</strong> Â· <span id="degB" class="editable" contenteditable="true">â—‹â—‹ëŒ€í•™êµ</span></div>
            <div><strong>M.S.</strong> Â· <span id="degM" class="editable" contenteditable="true">â—‹â—‹ëŒ€í•™êµ</span></div>
            <div><strong>Ph.D.</strong> Â· <span id="degP" class="editable" contenteditable="true">â—‹â—‹ëŒ€í•™êµ</span></div>
            <div><strong>Postdoc</strong> Â· <span id="degPostdoc" class="editable" contenteditable="true">â—‹â—‹ ì—°êµ¬ì†Œ/ëŒ€í•™êµ</span></div>
          </div>
          <div style="margin-top:10px; font-size:14px">
            <span class="muted">ì´ë©”ì¼</span> Â· <span id="profEmail" class="editable" contenteditable="true">email@example.edu</span>
          </div>
        </div>
      </div>
    </section>

    <section id="publications">
      <h2>ğŸ“„ ì—°êµ¬</h2>
      <p class="sub">
        <a href="https://inspirehep.net/authors/1013647?ui-citation-summary=true" target="_blank" rel="noopener">
          INSPIRE HEP(ë§í¬ëŠ” ì—¬ê¸°ì—)
        </a>
      </p>
    </section>

    <section id="teaching">
      <h2>ìˆ˜ì—…ìë£Œ</h2>
      <p class="sub">í•™ìƒì—ê²ŒëŠ” **ì§ì ‘ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ë§Œ** ë³´ì…ë‹ˆë‹¤. (Drive í´ë” UI ë…¸ì¶œ ì—†ìŒ)</p>

      <!-- ê´€ë¦¬ì ì „ìš©: ë‹¤ìš´ë¡œë“œ í•­ëª© í¸ì§‘ í¼ -->
      <div class="card admin-only" style="margin-bottom:12px">
        <strong>ê´€ë¦¬ì: ë‹¤ìš´ë¡œë“œ í•­ëª© í¸ì§‘</strong>
        <p class="mini">Drive íŒŒì¼ ì£¼ì†Œì˜ <code>/d/FILE_ID/</code> ì¤‘ <code>FILE_ID</code>ë§Œ ì…ë ¥í•˜ì„¸ìš”.</p>
        <div id="adminEditor" style="display:grid; gap:12px"></div>
        <button id="addItem" class="btn" style="margin-top:8px">+ í•­ëª© ì¶”ê°€</button>
      </div>

      <!-- ê³µê°œ: ê³¼ëª©ë³„ ë‹¤ìš´ë¡œë“œ ëª©ë¡ -->
      <div id="downloadList" class="grid"></div>
    </section>
  </main>

  <footer>
    <div class="foot">Â© <span id="year"></span> <span id="footerLab">â–¡â–¡â–¡ ì—°êµ¬ì‹¤</span></div>
  </footer>

<script>
  // ===== Safe storage =====
  const storage = (()=>{ try{ const t='__t'; localStorage.setItem(t,'1'); localStorage.removeItem(t); return localStorage; }catch(e){ return {getItem:()=>null,setItem:()=>{},removeItem:()=>{}} } })();

  // ===== Schema reset (bump to clear old edits) =====
  (function schemaReset(){
    const SCHEMA='lab.schema.v7';   // ìƒˆ ë°°í¬ ì‹œ ìˆ«ì ì˜¬ë¦¬ë©´ ì´ì „ ì €ì¥ê°’ ìë™ ì´ˆê¸°í™”
    const KEY='lab.__schema_version';
    try{
      const cur=storage.getItem(KEY);
      if(cur!==SCHEMA){
        Object.keys(localStorage||{}).filter(k=>k.startsWith('lab.')).forEach(k=>storage.removeItem(k));
        storage.setItem(KEY,SCHEMA);
        console.log('[lab] storage reset ->',SCHEMA);
      }
    }catch(e){}
  })();

  // ===== Theme =====
  const rootEl=document.documentElement;
  const savedTheme=storage.getItem('lab.theme');
  if(savedTheme==='dark') rootEl.classList.add('dark');
  document.getElementById('toggleTheme').addEventListener('click',()=>{
    rootEl.classList.toggle('dark');
    storage.setItem('lab.theme', rootEl.classList.contains('dark')?'dark':'light');
  });

  // ===== Auto-persist text =====
  function autoPersist(el,key){
    const v=storage.getItem(key); if(v!==null) el.textContent=v;
    let t; const save=()=>storage.setItem(key, el.textContent.trim());
    el.addEventListener('blur',save);
    el.addEventListener('input',()=>{ clearTimeout(t); t=setTimeout(save,200); });
  }
  [['lab.name','labName'],['lab.hero.title','heroTitle'],['lab.hero.desc','heroDesc'],
   ['lab.prof.name','profName'],['lab.prof.affil','profAffil'],['lab.prof.email','profEmail'],
   ['lab.prof.degB','degB'],['lab.prof.degM','degM'],['lab.prof.degP','degP'],['lab.prof.postdoc','degPostdoc']]
   .forEach(([k,id])=>{ const el=document.getElementById(id); if(el) autoPersist(el,k); });

  // footer sync
  function syncFooter(){ const name=(storage.getItem('lab.name')||'â–¡â–¡â–¡ ì—°êµ¬ì‹¤').replace(/<[^>]*>/g,''); document.getElementById('footerLab').textContent=name; }
  window.addEventListener('storage',syncFooter); syncFooter();

  // ===== Photo (dataURL) =====
  const profPhoto=document.getElementById('profPhoto'); const photoKey='lab.prof.photo';
  const savedPhoto=storage.getItem(photoKey); if(savedPhoto) profPhoto.src=savedPhoto;
  const changeBtn=document.getElementById('changePhoto'), removeBtn=document.getElementById('removePhoto');
  if(changeBtn) changeBtn.addEventListener('click',()=>document.getElementById('photoFile').click());
  const photoInput=document.getElementById('photoFile');
  if(photoInput) photoInput.addEventListener('change',(e)=>{
    const f=e.target.files&&e.target.files[0]; if(!f) return;
    const r=new FileReader(); r.onload=()=>{ storage.setItem(photoKey,r.result); profPhoto.src=r.result; }; r.readAsDataURL(f);
  });
  if(removeBtn) removeBtn.addEventListener('click',()=>{ storage.removeItem(photoKey); profPhoto.src=''; });

  // ===== Downloads (direct links; no Drive UI) =====
  // í•­ëª© êµ¬ì¡°: { course:'ì—­í•™'|'ì „ìê¸°'|'ì–‘ì', title:'íŒŒì¼ëª…', fileId:'FILE_ID' }
  let items = JSON.parse(storage.getItem('lab.downloads')||'null') || [
    { course:'ì—­í•™',   title:'ì˜ˆì‹œ) 1ì£¼ì°¨ ê°•ì˜ë…¸íŠ¸', fileId:'' },
    { course:'ì „ìê¸°', title:'ì˜ˆì‹œ) 1ì£¼ì°¨ ê°•ì˜ë…¸íŠ¸', fileId:'' },
    { course:'ì–‘ì',   title:'ì˜ˆì‹œ) 1ì£¼ì°¨ ê°•ì˜ë…¸íŠ¸', fileId:'' },
  ];
  const DL = id => `https://drive.google.com/uc?export=download&id=${id}`;

  const adminEditor = document.getElementById('adminEditor');
  const downloadList = document.getElementById('downloadList');

  function renderAdmin(){
    adminEditor.innerHTML = '';
    items.forEach((it, idx)=>{
      const row=document.createElement('div');
      row.style.display='grid';
      row.style.gap='6px';
      row.innerHTML = `
        <div class="row" style="justify-content:space-between">
          <strong>í•­ëª© ${idx+1}</strong>
          <button class="btn" data-del="${idx}">ì‚­ì œ</button>
        </div>
        <input data-idx="${idx}" data-k="course" placeholder="ê³¼ëª© (ì˜ˆ: ì—­í•™/ì „ìê¸°/ì–‘ì)" value="${it.course||''}" style="padding:8px; border:1px solid var(--border); border-radius:8px">
        <input data-idx="${idx}" data-k="title"  placeholder="íŒŒì¼ ì œëª© (ì˜ˆ: 1ì£¼ì°¨ ê°•ì˜ë…¸íŠ¸)" value="${it.title||''}" style="padding:8px; border:1px solid var(--border); border-radius:8px">
        <input data-idx="${idx}" data-k="fileId" placeholder="FILE_ID" value="${it.fileId||''}" style="padding:8px; border:1px solid var(--border); border-radius:8px">
        <div class="mini">ìµœì¢… ë§í¬: ${it.fileId ? DL(it.fileId) : '(FILE_ID ì…ë ¥ í•„ìš”)'}</div>
        <hr style="border:none; border-top:1px solid var(--border); margin:8px 0">
      `;
      adminEditor.appendChild(row);
    });
    adminEditor.querySelectorAll('input').forEach(inp=>{
      inp.addEventListener('input', ()=>{
        const i=+inp.dataset.idx, k=inp.dataset.k; items[i][k]=inp.value.trim();
        storage.setItem('lab.downloads', JSON.stringify(items));
        renderPublic();
      });
    });
    adminEditor.querySelectorAll('button[data-del]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const i=+btn.dataset.del; items.splice(i,1);
        storage.setItem('lab.downloads', JSON.stringify(items));
        renderAdmin(); renderPublic();
      });
    });
  }

  function renderPublic(){
    const courses = ['ì—­í•™','ì „ìê¸°','ì–‘ì'];
    downloadList.innerHTML='';
    courses.forEach(course=>{
      const group = items.filter(it => it.course===course && it.fileId);
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `<h3>${course}</h3>` + (group.length
        ? group.map(it=>`<p><a class="a-btn" href="${DL(it.fileId)}" target="_blank" rel="noopener">ğŸ“¥ ${it.title}</a></p>`).join('')
        : `<p class="mini">ì•„ì§ ê³µê°œëœ ìë£Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>`);
      downloadList.appendChild(card);
    });
  }

  const addItemBtn=document.getElementById('addItem');
  if(addItemBtn) addItemBtn.addEventListener('click', ()=>{
    items.push({course:'', title:'', fileId:''});
    storage.setItem('lab.downloads', JSON.stringify(items));
    renderAdmin(); renderPublic();
  });

  // ===== Reset all (admin only) =====
  const resetBtn=document.getElementById('resetAll');
  if(resetBtn) resetBtn.addEventListener('click',()=>{
    if(!confirm('ëª¨ë“  ì €ì¥ëœ í¸ì§‘ ë‚´ìš©ì„ ì´ˆê¸°í™”í• ê¹Œìš”?')) return;
    Object.keys(localStorage||{}).filter(k=>k.startsWith('lab.')).forEach(k=>storage.removeItem(k));
    location.reload();
  });

  // year
  document.getElementById('year').textContent=new Date().getFullYear();

  // ===== Mode gating: VIEW / EDIT (?edit=1) / ADMIN (file://, localhost) =====
  (function gateModes(){
    const isLocalHost = /^(localhost|127\.0\.0\.1)$/i.test(location.hostname);
    const isFile      = location.protocol === 'file:';
    const url         = new URL(location.href);
    const editFlag    = url.searchParams.has('edit') || location.hash.includes('edit');

    function setTextEditable(on){
      document.querySelectorAll('.editable').forEach(el=>{
        if(on) el.setAttribute('contenteditable','true');
        else   el.removeAttribute('contenteditable');
      });
    }
    function setAdminUI(on){
      document.querySelectorAll('.admin-only').forEach(el=>{
        el.style.display = on ? '' : 'none';
      });
    }
    function addBadge(text){
      const b=document.createElement('div');
      b.textContent=text;
      Object.assign(b.style,{
        position:'fixed', right:'12px', bottom:'12px', padding:'6px 10px',
        background:'#10b981', color:'#fff', borderRadius:'8px',
        fontSize:'12px', zIndex:9999, boxShadow:'0 2px 6px rgba(0,0,0,.2)'
      });
      document.body.appendChild(b);
    }

    // ê¸°ë³¸ VIEW
    setTextEditable(false);
    setAdminUI(false);

    if (isLocalHost || isFile) {
      // ADMIN: ëª¨ë“  í¸ì§‘ í—ˆìš©(ì‚¬ì§„/ê´€ë¦¬ í¼ í‘œì‹œ)
      setTextEditable(true);
      setAdminUI(true);
      addBadge('âœ ADMIN MODE (ì´ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì €ì¥)');
      renderAdmin();
    } else if (editFlag) {
      // EDIT: ê³µê°œì—ì„œ í…ìŠ¤íŠ¸ë§Œ ì„ì‹œ í¸ì§‘ (ë²„íŠ¼/ê´€ë¦¬ í¼ ìˆ¨ê¹€)
      setTextEditable(true);
      setAdminUI(false);
      addBadge('âœ EDIT MODE (í…ìŠ¤íŠ¸ë§Œ í¸ì§‘)');
    } else {
      // VIEW: ê³µê°œ ì½ê¸° ì „ìš©
      setTextEditable(false);
      setAdminUI(false);
    }

    renderPublic(); // ëª¨ë“  ëª¨ë“œì—ì„œ ê³µê°œ ëª©ë¡ ë Œë”
  })();
</script>
</body>
</html>
